

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/boji.png">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/boji.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="zeng-yq">
  <meta name="keywords" content="">
  
    <meta name="description" content="b站视频学习笔记！">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux系统编程3-文件系统">
<meta property="og:url" content="http://zengyq.cn/2022/03/02/linux%E7%BC%96%E7%A8%8B/linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B3-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="如此肤浅">
<meta property="og:description" content="b站视频学习笔记！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/20220128165013.png">
<meta property="article:published_time" content="2022-03-01T16:00:00.000Z">
<meta property="article:modified_time" content="2022-03-27T08:45:02.953Z">
<meta property="article:author" content="zeng-yq">
<meta property="article:tag" content="linux">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/20220128165013.png">
  
  
  <title>Linux系统编程3-文件系统 - 如此肤浅</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/agate.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/diy/toubudaziji.css">
<link rel="stylesheet" href="/css/diy/shubiao.css">
<link rel="stylesheet" href="/css/diy/gundongtiao.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"zengyq.cn","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"bb2c8c85e6445862aff762b6b3f0564b","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"athceUsMhoqEdJ8uuOhOx3Uq-9Nh9j0Va","app_key":"0ohfGqLbAMwzw4FimdgAcDHB","server_url":"https://athceusm.lc-cn-e1-shared.com","path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>如此肤浅</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                主页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-cliplist"></i>
                找文章
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/archives/">
                    
                    归档
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/">
                    
                    分类
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/tags/">
                    
                    标签
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/talking/">
                <i class="iconfont icon-kakao-talk-fill"></i>
                自言自语
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/message-board/">
                <i class="iconfont icon-speakernotes"></i>
                留言板
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/blog_bg2.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Linux系统编程3-文件系统">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-03-02 00:00" pubdate>
        2022年3月2日 凌晨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      17k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      138 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Linux系统编程3-文件系统</h1>
            
            <div class="markdown-body">
              <p>本文顺序对应视频 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1yJ411S7r6?p=3">Linux系统编程（李慧琴）_哔哩哔哩_bilibili</a></p>
<p><strong>学完本部分内容要求能实现 <code>ls</code> 命令一些基本的功能！！！</strong></p>
<h1 id="目录和文件">目录和文件</h1>
<h2 id="文件属性stat">文件属性(stat)</h2>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">// man 2 stat</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-comment">// 通过文件名得到文件属性，如果pathname是符号链接，则返回的是链接指向文件的属性</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">stat</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname, struct stat *statbuf)</span></span>;<br><span class="hljs-comment">// 通过一个文件描述符得到文件属性</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fstat</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, struct stat *statbuf)</span></span>;<br><span class="hljs-comment">// 与stat功能相同，但是如果pathname是符号链接，则返回链接本身的信息</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lstat</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname, struct stat *statbuf)</span></span>;<br></code></pre></div></td></tr></table></figure>
<p><code>stat</code> 结构体的内容如下：</p>
<p>一个文件所占磁盘大小等于 <code>st_blksize * stbloks</code>，而 <code>st_size</code> 只是文件的一个属性。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220223203128137.png" srcset="/img/loading.gif" lazyload /></p>
<p>通过 <code>stat</code> 命令可以查看文件的属性：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220224095436110.png" srcset="/img/loading.gif" lazyload /></p>
<ul>
<li><p>利用stat实现读取文件大小</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">include &lt;stdio.h&gt;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * off_t类型用于指示文件的偏移量，</span><br><span class="hljs-comment"> * 在一些体系结构上，off_t被定义为32位，</span><br><span class="hljs-comment"> * 而有些定义为64位，</span><br><span class="hljs-comment"> * 所以可以强制转化为64位来操作。</span><br><span class="hljs-comment"> * */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">off_t</span> <span class="hljs-title">flen</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *fname)</span></span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">statres</span>;</span><br>    <span class="hljs-keyword">if</span>(stat(fname, &amp;statres) &lt; <span class="hljs-number">0</span>)&#123;<br>        perror(<span class="hljs-string">&quot;stat()&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> statres.st_size;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span>&#123;<br>   <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Usage...\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>   &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>, (<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>)flen(argv[<span class="hljs-number">1</span>]));<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220224101433600.png" srcset="/img/loading.gif" lazyload /></p></li>
<li><p>制作一个很大的文件，而基本不占磁盘空间</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> ** argv)</span></span>&#123;<br><br>    <span class="hljs-keyword">int</span> fd;<br>    <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Usage...\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    fd = open(argv[<span class="hljs-number">1</span>], O_WRONLY|O_CREAT|O_TRUNC, <span class="hljs-number">0600</span>);<br>    <span class="hljs-keyword">if</span>(fd &lt; <span class="hljs-number">0</span>)&#123;<br>        perror(<span class="hljs-string">&quot;open()\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 生成一个5G的文件。</span><br>    <span class="hljs-comment">// 由于系统可能将下面的乘法当成有符合的整形来进行计算，</span><br>    <span class="hljs-comment">// 会导致益处，因此将数据类型放大。</span><br>    lseek(fd, <span class="hljs-number">5LL</span>*<span class="hljs-number">1024LL</span>*<span class="hljs-number">1024LL</span>*<span class="hljs-number">1024LL</span><span class="hljs-number">-1LL</span>, SEEK_SET);<br><br>    write(fd, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">1</span>);<br><br>    close(fd);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>结果如下：</p>
<p>可以发现，文件大小为5G，而只占了8个块，由于每个块512B，因此这个文件只占了4K的磁盘空间。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220224103939427.png" srcset="/img/loading.gif" lazyload /></p></li>
</ul>
<h2 id="文件访问权限">文件访问权限</h2>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># 如下，每行的第一个字段是文件的权限。存放在结构体stat的st_mode成员中。</span><br><span class="hljs-comment"># 其中，第一位表示文件类型，后面的3个一组，依次表示user的权限、同组用户的权限、其它用户的权限。</span><br>drwxrwxr-x 2 zengyq zengyq  4096 Feb 24 10:42 ./<br>drwxrwxr-x 5 zengyq zengyq  4096 Feb 24 09:56 ../<br>-rwxrwxr-x 1 zengyq zengyq 16976 Feb 24 10:38 big*<br>-rw-rw-r-- 1 zengyq zengyq   663 Feb 24 10:38 big.c<br></code></pre></div></td></tr></table></figure>
<p><strong><code>st_mode</code> 是一个16位的位图，用于表示文件类型，文件访问权限，及特殊权限位。</strong></p>
<ul>
<li><p>写一个程序测试文件类型</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">include &lt;stdio.h&gt;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-comment">// 由于char类型不至于有没有符号，不太安全</span><br><span class="hljs-comment">// 因此返回int来代替</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ftype</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *fname)</span></span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">statres</span>;</span><br><br>    <span class="hljs-keyword">if</span>(stat(fname, &amp;statres) &lt; <span class="hljs-number">0</span>)&#123;<br>        perror(<span class="hljs-string">&quot;stat()\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(S_ISREG(statres.st_mode))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;-&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(S_ISDIR(statres.st_mode))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;d&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(S_ISSOCK(statres.st_mode))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;s&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(S_ISCHR(statres.st_mode))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;c&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(S_ISBLK(statres.st_mode))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;b&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(S_ISFIFO(statres.st_mode))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;p&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(S_ISLNK(statres.st_mode))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;l&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;?&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span>&#123;<br><br>    <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Usage...\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c\n&quot;</span>, ftype(argv[<span class="hljs-number">1</span>]));<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>测试结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220224153230907.png" srcset="/img/loading.gif" lazyload /></p></li>
<li><p>umask</p>
<p>创建文件时，若没有指定权限，则文件权限按照 <code>0666 &amp; ~umask</code> 来计算得到，采用这种机制的目的是防止产生权限过松的文件。</p>
<p>直接输入命令 <code>umask</code> 可以查看当前的值：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220224213047905.png" srcset="/img/loading.gif" lazyload /></p>
<p>也可修改 <code>umask</code> 的值：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220224213159823.png" srcset="/img/loading.gif" lazyload /></p>
<p><code>umask</code> 命令是由 <code>umask()</code> 函数封装而来，该函数用于在进程中修改 <code>umask</code> 的值：</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">// man 2 umask</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">mode_t</span> <span class="hljs-title">umask</span><span class="hljs-params">(<span class="hljs-keyword">mode_t</span> mask)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
</ul>
<h2 id="文件权限的管理更改">文件权限的管理/更改</h2>
<ul>
<li><p>chmod与fchmod</p>
<p><code>chmod</code> 命令可以修改文件的权限：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220224214042130.png" srcset="/img/loading.gif" lazyload /></p>
<p>在进程中操作文件时，若需要临时改变该文件的权限，则使用函数 <code>chmod()</code> 来改变文件权限信息：</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span><br><br><span class="hljs-comment">// 更改pathname文件的权限为mode</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">chmod</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname, <span class="hljs-keyword">mode_t</span> mode)</span></span>;<br><span class="hljs-comment">// 更改某个打开的文件fd的权限为mode</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fchmod</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">mode_t</span> mode)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
</ul>
<h2 id="硬链接符号连接">硬链接、符号连接</h2>
<ul>
<li><p>创建硬链接：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># 为文件file_a创建硬链接file_b</span><br>ln file_a file_b<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220226212550953.png" srcset="/img/loading.gif" lazyload /></p></li>
<li><p>创建符号链接</p>
<p>符号链接就是创建文件的快捷方式，且符号链接文件不占磁盘空间。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">ln -s file_a file_b<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220226213018670.png" srcset="/img/loading.gif" lazyload /></p>
<p>若此时删除符号链接所指向的目标文件，则会提示该符号链接指向错误：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220226213216243.png" srcset="/img/loading.gif" lazyload /></p></li>
<li><p>link()</p>
<p>上面介绍的命令 <code>ln</code> 是通过 <code>link()</code> 函数封装得到的。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-comment">// 创建一个链接</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">link</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *oldpath, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *newpath)</span></span>;<br><span class="hljs-comment">// 删除一个链接</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">unlink</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname)</span></span>;<br></code></pre></div></td></tr></table></figure>
<p>注意：<code>unlink()</code> 并不是删除文件，而 <code>remove()</code> 才是从磁盘删除文件。命令 <code>rm</code> 是通过 <code>remove()</code> 函数封装得到的。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>rename()（补充）</p>
<p><code>rename()</code> 可以修改文件名字，也可以修改文件位置。命令 <code>mv</code> 是通过 <code>rename()</code> 函数封装得到的。若新旧路径一样，则是改名功能；若新旧路径不一样，则是移动文件位置功能。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">rename</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *oldpath, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *newpath)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
</ul>
<h2 id="utime">utime</h2>
<p>更改文件最后一次读和写的时间。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">include &lt;sys/types.h&gt;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;utime.h&gt;</span></span><br>   <br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">utime</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *filename, <span class="hljs-keyword">const</span> struct utimbuf *times)</span></span>;<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220226214626597.png" srcset="/img/loading.gif" lazyload /></p>
<h2 id="目录的创建和销毁">目录的创建和销毁</h2>
<ul>
<li><p>mkdir()</p>
<p>创建一个目录，并设置操作权限。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mkdir</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname, <span class="hljs-keyword">mode_t</span> mode)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>rmdir()</p>
<p>删除一个目录，只能删除空目录。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">rmdir</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
</ul>
<h2 id="更改当前工作路径">更改当前工作路径</h2>
<ul>
<li><p>chdir()</p>
<p>命令 <code>cd</code> 就是用 <code>chdir()</code> 函数封装得到的。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">chdir</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *path)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fchdir</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>getcwd()</p>
<p>获取当前工作目录。</p>
<p>命令 <code>pwd</code> 就是用 <code>getcwd()</code> 函数封装得到的。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">char</span> *<span class="hljs-title">getcwd</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *buf, <span class="hljs-keyword">size_t</span> size)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
</ul>
<h1 id="分析目录读取目录内容">分析目录/读取目录内容</h1>
<p><strong>补充：</strong>通配符在 <code>shell</code> 环境中会被解析掉，如下所示：</p>
<ol type="1">
<li><p>编写如下代码</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,  <span class="hljs-keyword">char</span> **argv)</span></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;argc = %d\n&quot;</span>, argc);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure></li>
<li><p>执行如下命令</p>
<p>可以发现，输出的 argc=6，而不是2，说明 shell 环境中的 <code>*</code> 被解析了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228082347564.png" srcset="/img/loading.gif" lazyload /></p></li>
</ol>
<h2 id="glob">glob</h2>
<p>找到符合指定模式的文件路径。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;glob.h&gt;</span></span><br><br><span class="hljs-comment">// 第1个参数：分析匹配模式pattern，得到路径名（*.c 就是一个pattern）</span><br><span class="hljs-comment">// 第2个参数：flags限制glob的行为</span><br><span class="hljs-comment">// 第3个参数：是一个指向函数的指针，该函数保存回填的出错的路径和出错的原因</span><br><span class="hljs-comment">// 第4个参数：将解析的结果回到到pglob所指向的地址中</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">glob</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pattern, <span class="hljs-keyword">int</span> flags,</span></span><br><span class="hljs-params"><span class="hljs-function">         <span class="hljs-keyword">int</span> (*errfunc) (<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *epath, <span class="hljs-keyword">int</span> eerrno),</span></span><br><span class="hljs-params"><span class="hljs-function">         <span class="hljs-keyword">glob_t</span> *pglob)</span></span>;<br><span class="hljs-comment">// glob_t类型如下图</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">globfree</span><span class="hljs-params">(<span class="hljs-keyword">glob_t</span> *pglob)</span></span>;<br></code></pre></div></td></tr></table></figure>
<figure>
<img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228083248034.png" srcset="/img/loading.gif" lazyload alt="image-20220228083248034" /><figcaption aria-hidden="true">image-20220228083248034</figcaption>
</figure>
<ul>
<li><p>例子</p>
<p>解析模式 <code>/etc/</code><em>.c</em></p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;glob.h&gt;</span></span><br><br><span class="hljs-comment">// 需要解析的pattern定义如下</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PAT <span class="hljs-meta-string">&quot;/etc/a*.conf&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> 0</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">errfunc_</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *errpath, <span class="hljs-keyword">int</span> eerrno)</span></span>&#123;<br>    <span class="hljs-built_in">puts</span>(errpath);<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;ERROR MSG:%s\n&quot;</span>, strerror(eerror));<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br><br>    <span class="hljs-keyword">int</span> err, i;<br>    <span class="hljs-keyword">glob_t</span> globres;<br><br>    <span class="hljs-comment">// 参数flags本质实现是位图，0表示取默认值</span><br>    <span class="hljs-comment">// 第3个参数：出错的路径和原因，若不需要就传NULL</span><br>    err = glob(PAT, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, &amp;globres);<br>    <span class="hljs-comment">// err非0表示失败</span><br>    <span class="hljs-keyword">if</span>(err)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error code = %d\n&quot;</span>, err);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 遍历返回的结果</span><br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;globres.gl_pathc; i++)&#123;<br>        <span class="hljs-built_in">puts</span>(globres.gl_pathv[i]);<br>    &#125;<br>	<span class="hljs-comment">// 释放内存</span><br>    globfree(&amp;globres);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>执行结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228084916601.png" srcset="/img/loading.gif" lazyload /></p></li>
</ul>
<h2 id="采用其它函数来实现glob的功能">采用其它函数来实现glob的功能</h2>
<ul>
<li><p>opendir()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;dirent.h&gt;</span></span><br><br><span class="hljs-comment">// 通过名字打开目录流</span><br><span class="hljs-function">DIR *<span class="hljs-title">opendir</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name)</span></span>;<br><span class="hljs-comment">// 将打开的文件描述符转化为目录流的操作</span><br><span class="hljs-function">DIR *<span class="hljs-title">fdopendir</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>closedir()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;dirent.h&gt;</span></span><br><br><span class="hljs-comment">// 关闭目录流</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">closedir</span><span class="hljs-params">(DIR *dirp)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>readdir()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;dirent.h&gt;</span></span><br><br><span class="hljs-comment">// 读取打开的目录流dirp</span><br><span class="hljs-comment">// 返回值是读到的一行内容</span><br><span class="hljs-function">struct dirent *<span class="hljs-title">readdir</span><span class="hljs-params">(DIR *dirp)</span></span>;<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228101054846.png" srcset="/img/loading.gif" lazyload /></p></li>
<li><p>rewinddir()</p></li>
<li><p>seekdir()</p></li>
<li><p>telldir()</p></li>
<li><p>例子</p>
<p>求 <code>/etc</code> 下有多少个文件。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">include &lt;dirent.h&gt;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PAT <span class="hljs-meta-string">&quot;/etc&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    DIR *dp;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dirent</span> *<span class="hljs-title">cur</span>;</span><br><br>    dp = opendir(PAT);<br>    <span class="hljs-keyword">if</span>(dp == <span class="hljs-literal">NULL</span>)&#123;<br><br>        perror(<span class="hljs-string">&quot;opendir()\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">while</span>((cur = readdir(dp)) != <span class="hljs-literal">NULL</span>)&#123;<br>        <span class="hljs-built_in">puts</span>(cur-&gt;d_name);<br>    &#125;<br>    closedir(dp);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228102424063.png" srcset="/img/loading.gif" lazyload /></p></li>
</ul>
<h1 id="系统数据文件和信息">系统数据文件和信息</h1>
<h2 id="etcpasswd">/etc/passwd</h2>
<ul>
<li><p>getpwuid() 与 getpwnam()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;pwd.h&gt;</span></span><br><br><span class="hljs-comment">// 通过name询用户信息</span><br><span class="hljs-function">struct passwd *<span class="hljs-title">getpwnam</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name)</span></span>;<br><span class="hljs-comment">// 通过uid查询用户信息</span><br><span class="hljs-function">struct passwd *<span class="hljs-title">getpwuid</span><span class="hljs-params">(<span class="hljs-keyword">uid_t</span> uid)</span></span>;<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228160350825.png" srcset="/img/loading.gif" lazyload /></p></li>
<li><p>例子</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;pwd.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">passwd</span> *<span class="hljs-title">pwdline</span>;</span><br>    <br>    <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Usage...\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    pwdline = getpwuid(atoi(argv[<span class="hljs-number">1</span>]));<br>    <span class="hljs-built_in">puts</span>(pwdline-&gt;pw_name);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228160839948.png" srcset="/img/loading.gif" lazyload /></p></li>
</ul>
<h2 id="etcgroup">/etc/group</h2>
<ul>
<li><p>getgrgid() 和 getgrgrnam()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;grp.h&gt;</span></span><br><br><span class="hljs-comment">// 通过name查询组的信息</span><br><span class="hljs-function">struct group *<span class="hljs-title">getgrnam</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name)</span></span>;<br><span class="hljs-comment">// 通过gid查询组的信息</span><br><span class="hljs-function">struct group *<span class="hljs-title">getgrgid</span><span class="hljs-params">(<span class="hljs-keyword">gid_t</span> gid)</span></span>;<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228161629116.png" srcset="/img/loading.gif" lazyload /></p></li>
</ul>
<h2 id="etcshadow">/etc/shadow</h2>
<p>用于存储 Linux 系统中用户的密码信息，又称为“影子文件”。</p>
<ul>
<li><p>getspnam()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/* General shadow password file API */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;shadow.h&gt;</span></span><br><br><span class="hljs-comment">// 通过一个username获取它在shadow中的一行内容</span><br><span class="hljs-function">struct spwd *<span class="hljs-title">getspnam</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name)</span></span>;<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228164409574.png" srcset="/img/loading.gif" lazyload /></p></li>
<li><p>crypt()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;crypt.h&gt;</span></span><br><br><span class="hljs-comment">// phrase：需要加密的串</span><br><span class="hljs-comment">// setting：杂质（盐）</span><br><span class="hljs-function"><span class="hljs-keyword">char</span> *<span class="hljs-title">crypt</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *phrase, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *setting)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>getpass()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-comment">// 去掉终端的回显功能，并给出提示符prompt</span><br><span class="hljs-function"><span class="hljs-keyword">char</span> *<span class="hljs-title">getpass</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *prompt)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
</ul>
<h2 id="密码校验实例">密码校验实例</h2>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;crypt.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;shadow.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span>&#123;<br><br>    <span class="hljs-keyword">char</span> *input_pass;<br>    <span class="hljs-keyword">char</span> *crypted_pass;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spwd</span> *<span class="hljs-title">shadowline</span>;</span><br><br>    <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>)&#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Usage...\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    input_pass = getpass(<span class="hljs-string">&quot;PassWord:&quot;</span>);<br>    <span class="hljs-keyword">if</span>(input_pass == <span class="hljs-literal">NULL</span>)&#123;<br>        perror(<span class="hljs-string">&quot;getpass()\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    shadowline = getspnam(argv[<span class="hljs-number">1</span>]);<br>    crypted_pass = crypt(input_pass, shadowline-&gt;sp_pwdp);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(shadowline-&gt;sp_pwdp, crypted_pass) == <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;ok!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;faile!&quot;</span>);<br>    &#125;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>若直接执行 <code>make</code> 会报如下错误：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228180302686.png" srcset="/img/loading.gif" lazyload /></p>
<p>查看 <code>man</code> 手册发现需要链接动态库 <code>crypt</code>：</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228180541994.png" srcset="/img/loading.gif" lazyload /></p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">gcc chkpass.c -o chkpass -lcrypt<br></code></pre></div></td></tr></table></figure>
<p>执行结果如下：</p>
<p><code>shadow</code> 文件需要root权限才能访问。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228180702590.png" srcset="/img/loading.gif" lazyload /></p>
<h2 id="时间戳">时间戳</h2>
<p>时间的表示类型有：</p>
<p><code>time_t</code>：一个大整型数，该整数值表示自UTC时间1970年1月1日00:00以来经过的秒数，即UNIX时间戳；</p>
<p><code>char *</code>；</p>
<p><code>struct</code>：结构体</p>
<ul>
<li><p>time()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">include &lt;time.h&gt;<br><br><span class="hljs-comment">// 以秒的形式获取时间</span><br><span class="hljs-comment">// 如果参数tloc不为NULL，则返回的值存放在tloc所指向的地址中，</span><br><span class="hljs-comment">// 否则需要用变量来接收。</span><br><span class="hljs-function"><span class="hljs-keyword">time_t</span> <span class="hljs-title">time</span><span class="hljs-params">(<span class="hljs-keyword">time_t</span> *tloc)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>gmtime() 与 localtime()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;time.h&gt;</span></span><br><br><span class="hljs-comment">// 将time_t类型的时间转化为世界标准时间的结构体形式</span><br><span class="hljs-function">struct tm *<span class="hljs-title">gmtime</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">time_t</span> *timep)</span></span>;<br><span class="hljs-comment">// 将time_t类型的时间转化为本地时间的结构体形式</span><br><span class="hljs-function">struct tm *<span class="hljs-title">localtime</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">time_t</span> *timep)</span></span>;<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220228182743113.png" srcset="/img/loading.gif" lazyload /></p></li>
<li><p>mktime()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;time.h&gt;</span></span><br><br><span class="hljs-comment">// 将结构体类型的时间转化为时间戳形式</span><br><span class="hljs-function"><span class="hljs-keyword">time_t</span> <span class="hljs-title">mktime</span><span class="hljs-params">(struct tm *tm)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>strftime()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;time.h&gt;</span></span><br><br><span class="hljs-comment">// 将结构体类型的时间，按照format格式，放到max大小的缓冲区s中</span><br><span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">strftime</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *s, <span class="hljs-keyword">size_t</span> max, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *format, <span class="hljs-keyword">const</span> struct tm *tm)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
</ul>
<h2 id="时间实例一">时间实例一</h2>
<p>每秒在 <code>/etc/out</code> 文件内加一行当前时间戳：</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FNAME <span class="hljs-meta-string">&quot;/tmp/out&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BUFSIZE 1024</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tm</span> *<span class="hljs-title">tm</span>;</span><br>    FILE *fp;<br>    <span class="hljs-keyword">char</span> buf[BUFSIZE];<br>    <span class="hljs-keyword">int</span> count;<br>    <span class="hljs-keyword">time_t</span> stamp;<br><br>    fp = fopen(FNAME, <span class="hljs-string">&quot;a+&quot;</span>);<br>    <span class="hljs-keyword">if</span>(fp == <span class="hljs-literal">NULL</span>)&#123;<br>        perror(<span class="hljs-string">&quot;fopen()\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">while</span>(fgets(buf, BUFSIZE, fp) != <span class="hljs-literal">NULL</span>)&#123;<br>        count++;<br>    &#125;<br><br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>        time(&amp;stamp);<br>        tm = localtime(&amp;stamp);<br>        <span class="hljs-built_in">fprintf</span>(fp, <span class="hljs-string">&quot;%-4d%d-%d-%d %d:%d:%d\n&quot;</span>, ++count, \<br>                        tm-&gt;tm_year+<span class="hljs-number">1900</span>, tm-&gt;tm_mon+<span class="hljs-number">1</span>, tm-&gt;tm_mday+<span class="hljs-number">1</span>, \<br>                        tm-&gt;tm_hour, tm-&gt;tm_min, tm-&gt;tm_sec);<br>        fflush(fp);<br>        sleep(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    fclose(fp);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>执行结果如下：</p>
<p><code>tail -f 文件名</code>，动态显示文件尾的内容。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220301185811852.png" srcset="/img/loading.gif" lazyload /></p>
<h2 id="时间实例二">时间实例二</h2>
<p>计算从现在开始，100天后是哪天？</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TIMESTRSIZE 1024</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br><br>    <span class="hljs-keyword">time_t</span> stamp;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tm</span> *<span class="hljs-title">tm</span>;</span><br>    <span class="hljs-keyword">char</span> timestr[TIMESTRSIZE];<br><br>    stamp = time(<span class="hljs-literal">NULL</span>);<br><br>    tm = localtime(&amp;stamp);<br>    strftime(timestr, TIMESTRSIZE, <span class="hljs-string">&quot;Now:%Y-%m-%d&quot;</span>, tm);<br>    <span class="hljs-built_in">puts</span>(timestr);<br><br>    tm-&gt;tm_mday += <span class="hljs-number">100</span>;<br>    (<span class="hljs-keyword">void</span>)mktime(tm);<br>    strftime(timestr, TIMESTRSIZE, <span class="hljs-string">&quot;100 days later:%Y-%m-%d&quot;</span>, tm);<br>    <span class="hljs-built_in">puts</span>(timestr);<br>    tm-&gt;tm_mday += <span class="hljs-number">100</span>;<br>    (<span class="hljs-keyword">void</span>)mktime(tm);<br>    strftime(timestr, TIMESTRSIZE, <span class="hljs-string">&quot;100 days later:%Y-%m-%d&quot;</span>, tm);<br>    <span class="hljs-built_in">puts</span>(timestr);<br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220301191727329.png" srcset="/img/loading.gif" lazyload /></p>
<h1 id="进程环境">进程环境</h1>
<h2 id="进程的终止">进程的终止</h2>
<ul>
<li>正常终止
<ul>
<li><p>从 <code>main</code> 函数返回</p>
<p>在 <code>main</code> 函数最后写一个 <code>return 0;</code></p></li>
<li><p>调用 <code>exit()</code></p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-comment">// 使一个进程正常终止，并将进程状态&#x27;status &amp; 0377&#x27;带回去，</span><br><span class="hljs-comment">// 并逆序调用被 atexit() 注册的函数。</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exit</span><span class="hljs-params">(<span class="hljs-keyword">int</span> status)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>调用 <code>_exit()</code> 或 <code>_Exit()</code></p>
<p><code>_exit()</code> 使系统调用，<code>exit()</code> 是库函数。</p>
<p>使用 <code>exit()</code> 的时候，会先终止当前进程的其它处理程序，再正常结束当前进程。</p>
<p>而 <code>_exit()</code> 会直接结束当前进程。</p></li>
<li><p>最后一个线程从其启动例程返回</p>
<p>启动例程其实就是进程本身。</p></li>
<li><p>最后一个线程调用 <code>pthread_exit()</code></p></li>
</ul></li>
<li>异常终止
<ul>
<li>调用 <code>abort()</code></li>
<li>接到一个信号并终止</li>
<li>最后一个线程对其取消请求作出响应</li>
</ul></li>
</ul>
<h2 id="钩子函数atexit">钩子函数(atexit)</h2>
<p>一般用于释放空间。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-comment">// 注册一个函数，这个函数会在进程正常终止的时候调用</span><br><span class="hljs-comment">// 参数是一个函数</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">atexit</span><span class="hljs-params">(<span class="hljs-keyword">void</span> (*function)(<span class="hljs-keyword">void</span>))</span></span>;<br></code></pre></div></td></tr></table></figure>
<ul>
<li><p>例子：</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">f1</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>&#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;f1() is working!&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">f2</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>&#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;f2() is working!&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">f3</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>&#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;f3() is working!&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Begin!&quot;</span>);<br>    <br>    atexit(f1);<br>    atexit(f2);<br>    atexit(f3);<br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;End!&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220301195450058.png" srcset="/img/loading.gif" lazyload /></p></li>
</ul>
<h2 id="命令行参数的分析">命令行参数的分析</h2>
<ul>
<li><p>getopt() 与 getopt_long()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-comment">// argc：命令行传参的个数</span><br><span class="hljs-comment">// argv：参数的内容</span><br><span class="hljs-comment">// optstring：不包含减号的选项字符串，其中的每个字符是一个选项字符（如下面例子）</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getopt</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * <span class="hljs-keyword">const</span> argv[], </span></span><br><span class="hljs-params"><span class="hljs-function">           <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *optstring)</span></span>;<br><br><span class="hljs-comment">// 当在分析上面命令行的串optstring时，如果串中某个选项加了冒号&#x27;:&#x27;，则optarg默认指向冒号修饰的这个选项</span><br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">char</span> *optarg;<br><span class="hljs-comment">// optind记录当前当前读到的参数下标</span><br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">int</span> optind, opterr, optopt;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getopt_long</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * <span class="hljs-keyword">const</span> argv[], </span></span><br><span class="hljs-params"><span class="hljs-function">                <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *optstring, </span></span><br><span class="hljs-params"><span class="hljs-function">                <span class="hljs-keyword">const</span> struct option *longopts, </span></span><br><span class="hljs-params"><span class="hljs-function">                <span class="hljs-keyword">int</span> *longindex)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>例子</p>
<p>解析命令行中的命令。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br>  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;time.h&gt;</span></span><br>  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br>  <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br>  <br>  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TIMESTRSIZE 1024</span><br>  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FMTSTRSIZE 1024</span><br>  <br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">   *  -y: year</span><br><span class="hljs-comment">   *  -m: monty</span><br><span class="hljs-comment">   *  -d: day</span><br><span class="hljs-comment">   *  -H: hour</span><br><span class="hljs-comment">   *  -M: minute</span><br><span class="hljs-comment">   *  -S: second</span><br><span class="hljs-comment">   */</span><br>  <br>  <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span>&#123;<br>  <br>      <span class="hljs-keyword">time_t</span> stamp;<br>      <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tm</span> *<span class="hljs-title">tm</span>;</span><br>      FILE *fd = <span class="hljs-built_in">stdout</span>;<br>      <span class="hljs-keyword">char</span> timestr[TIMESTRSIZE];<br>      <span class="hljs-keyword">int</span> c;<br>      <span class="hljs-keyword">char</span> fmtstr[FMTSTRSIZE];<br>  <br>      fmtstr[<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>  <br>      stamp = time(<span class="hljs-literal">NULL</span>);<br>  <br>      tm = localtime(&amp;stamp);<br>  <br>      <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>          <span class="hljs-comment">// H和y后面加&#x27;:&#x27;代表这两个选项可以加参数</span><br>          <span class="hljs-comment">// 如果optstring的第一个字符是&#x27;-&#x27;的话，</span><br>          <span class="hljs-comment">// 遇到每一个非选项的参数都返回1</span><br>          c = getopt(argc, argv, <span class="hljs-string">&quot;-H:MSy:md&quot;</span>);<br>          <span class="hljs-keyword">if</span>(c &lt; <span class="hljs-number">0</span>)&#123;<br>              <span class="hljs-keyword">break</span>;<br>          &#125;<br>          <span class="hljs-keyword">switch</span>(c)&#123;<br>              <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                  fd = fopen(argv[optind<span class="hljs-number">-1</span>], <span class="hljs-string">&quot;w&quot;</span>);<br>                  <span class="hljs-keyword">if</span>(fd == <span class="hljs-literal">NULL</span>)&#123;<br>                      perror(<span class="hljs-string">&quot;fopen()&quot;</span>);<br>                      <span class="hljs-comment">// 如果有文件则写到文件中，否则写到终端上</span><br>                      fd = <span class="hljs-built_in">stdout</span>;<br>                  &#125;<br>                  <span class="hljs-keyword">break</span>;<br>              <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;H&#x27;</span>:<br>                  <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(optarg, <span class="hljs-string">&quot;12&quot;</span>) == <span class="hljs-number">0</span>)&#123;<br>                      <span class="hljs-built_in">strncat</span>(fmtstr, <span class="hljs-string">&quot;%I(%P) &quot;</span>, FMTSTRSIZE);<br>                  &#125;<br>                  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(optarg, <span class="hljs-string">&quot;24&quot;</span>) == <span class="hljs-number">0</span>)&#123;<br>                      <span class="hljs-built_in">strncat</span>(fmtstr, <span class="hljs-string">&quot;%H &quot;</span>, FMTSTRSIZE);<br>                  &#125;<br>                  <span class="hljs-keyword">else</span>&#123;<br>                      <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Invalid argument of -H\n&quot;</span>);<br>                  &#125;<br>                  <span class="hljs-keyword">break</span>;<br>              <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;M&#x27;</span>:<br>                  <span class="hljs-built_in">strncat</span>(fmtstr, <span class="hljs-string">&quot;%M &quot;</span>, FMTSTRSIZE);<br>                  <span class="hljs-keyword">break</span>;<br>              <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;S&#x27;</span>:<br>                  <span class="hljs-built_in">strncat</span>(fmtstr, <span class="hljs-string">&quot;%S &quot;</span>, FMTSTRSIZE);<br>                  <span class="hljs-keyword">break</span>;<br>              <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;y&#x27;</span>:<br>                  <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(optarg, <span class="hljs-string">&quot;2&quot;</span>) == <span class="hljs-number">0</span>)&#123;<br>                      <span class="hljs-built_in">strncat</span>(fmtstr, <span class="hljs-string">&quot;%y &quot;</span>, FMTSTRSIZE);<br>                  &#125;<br>                  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(optarg, <span class="hljs-string">&quot;4&quot;</span>) == <span class="hljs-number">0</span>)&#123;<br>                      <span class="hljs-built_in">strncat</span>(fmtstr, <span class="hljs-string">&quot;%Y&quot;</span>, FMTSTRSIZE);<br>                  &#125;<br>                  <span class="hljs-keyword">else</span>&#123;<br>                      <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Invalid argument of -y\n&quot;</span>);<br>                  &#125;<br>                  <span class="hljs-keyword">break</span>;<br>              <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;m&#x27;</span>:<br>                  <span class="hljs-built_in">strncat</span>(fmtstr, <span class="hljs-string">&quot;%m &quot;</span>, FMTSTRSIZE);<br>                  <span class="hljs-keyword">break</span>;<br>              <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;d&#x27;</span>:<br>                  <span class="hljs-built_in">strncat</span>(fmtstr, <span class="hljs-string">&quot;%d &quot;</span>, FMTSTRSIZE);<br>                  <span class="hljs-keyword">break</span>;<br>              <span class="hljs-keyword">default</span>:<br>                      <span class="hljs-keyword">break</span>;<br>          &#125;<br>      &#125;<br>  <br>  <br>      <span class="hljs-built_in">strncat</span>(fmtstr, <span class="hljs-string">&quot;\n&quot;</span>, FMTSTRSIZE);<br>      strftime(timestr, TIMESTRSIZE, fmtstr, tm);<br>      <span class="hljs-built_in">fputs</span>(timestr, fd);<br>  	<span class="hljs-keyword">if</span>(fd != <span class="hljs-built_in">stdout</span>)&#123;<br>          fclose(fd);<br>      &#125;<br>  <br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  <br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220302084101828.png" srcset="/img/loading.gif" lazyload /></p></li>
</ul>
<h2 id="环境变量">环境变量</h2>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220302092028467.png" srcset="/img/loading.gif" lazyload /></p>
<p>查看环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">export</span><br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220302090832067.png" srcset="/img/loading.gif" lazyload /></p>
<ul>
<li><p>输出所有环境变量</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">char</span> **environ;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; environ[i] != <span class="hljs-literal">NULL</span>; i++)&#123;<br>        <span class="hljs-built_in">puts</span>(environ[i]);<br>    &#125;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure></li>
<li><p>getenv()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">char</span> *<span class="hljs-title">getenv</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>setenv()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-comment">// 改变或者添加一个环节变量的值</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">setenv</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *value, </span></span><br><span class="hljs-params"><span class="hljs-function">          <span class="hljs-keyword">int</span> overwrite)</span></span>;<br><span class="hljs-comment">// 删除一个环境变量</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">unsetenv</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>putenv()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-comment">// 改变或者添加一个环节变量的值</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">putenv</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *<span class="hljs-built_in">string</span>)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
</ul>
<h2 id="函数跳转">函数跳转</h2>
<ul>
<li><p>setjmp() 与 longjmp()</p>
<p>实现跨函数的安全跳转。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;setjmp.h&gt;</span></span><br><br><span class="hljs-comment">// 设置跳转点</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">setjmp</span><span class="hljs-params">(jmp_buf env)</span></span>;<br><span class="hljs-comment">// 跳到某个跳转点</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">longjmp</span><span class="hljs-params">(jmp_buf env, <span class="hljs-keyword">int</span> val)</span></span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>例子</p>
<p>现有代码和执行结果如下：</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">include &lt;stdio.h&gt;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">c</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Begin.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():End.\n&quot;</span>, __FUNCTION__);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">b</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Begin.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Call c().\n&quot;</span>, __FUNCTION__);<br>    c();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():c() returned.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():End.\n&quot;</span>, __FUNCTION__);<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">a</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Begin.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Call b().\n&quot;</span>, __FUNCTION__);<br>    b();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():b() returned.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():End.\n&quot;</span>, __FUNCTION__);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Begin.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Call a().\n&quot;</span>, __FUNCTION__);<br>    a();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():a() returned.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():End.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>在使用 <code>setjmp()</code> 和 <code>longjmp()</code> 后，结果如下：</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;setjmp.h&gt;</span></span><br><br><span class="hljs-keyword">static</span> jmp_buf save;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">c</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Begin.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Jump now!\n&quot;</span>, __FUNCTION__);<br>    longjmp(save, <span class="hljs-number">6</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():End.\n&quot;</span>, __FUNCTION__);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">b</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Begin.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Call c().\n&quot;</span>, __FUNCTION__);<br><br>    c();<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():c() returned.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():End.\n&quot;</span>, __FUNCTION__);<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">a</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">int</span> ret;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Begin.\n&quot;</span>, __FUNCTION__);<br>    ret = setjmp(save);<br>    <span class="hljs-keyword">if</span>(ret == <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Call b().\n&quot;</span>, __FUNCTION__);<br>        b();<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():b() returned.\n&quot;</span>, __FUNCTION__);<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Jumped back here with code %d\n&quot;</span>, __FUNCTION__, ret);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():End.\n&quot;</span>, __FUNCTION__);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Begin.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():Call a().\n&quot;</span>, __FUNCTION__);<br><br>    a();<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():a() returned.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s():End.\n&quot;</span>, __FUNCTION__);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220302100923983.png" srcset="/img/loading.gif" lazyload /></p></li>
</ul>
<h2 id="资源的获取及控制">资源的获取及控制</h2>
<ul>
<li><p>getrlimit() 与 setrlimit()</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/resource.h&gt;</span></span><br><br><span class="hljs-comment">// 获取resource的资源总量，放到rlim中</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getrlimit</span><span class="hljs-params">(<span class="hljs-keyword">int</span> resource, struct rlimit *rlim)</span></span>;<br><span class="hljs-comment">// 将资源rlim设置给resource</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">setrlimit</span><span class="hljs-params">(<span class="hljs-keyword">int</span> resource, <span class="hljs-keyword">const</span> struct rlimit *rlim)</span></span>;<br></code></pre></div></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/zeng-yq/drawingBed/img/image-20220302101705180.png" srcset="/img/loading.gif" lazyload /></p></li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/linux/">linux</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/linux/">linux</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/03/07/linux%E7%BC%96%E7%A8%8B/linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B4-%E8%BF%9B%E7%A8%8B/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Linux系统编程4-进程</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/02/26/Ubuntu%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/">
                        <span class="hidden-mobile">Ubuntu安装wine应用</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  
  
  <div class="statistics">
  <!-- 统计网站运行时间 -->
    

    <span id="showrunDate">
      本站已运行 
      <span id="dnum" style="display: none"></span>  
      
         天 
      
      <span id="hnum" style="display: none"></span>
      
         小时 
      
      <span id="mnum" style="display: none"></span>
      
         分 
       
      <span id="snum" style="display: none"></span>
      
         秒
      
    </span>
   </div>
    
    <script type="text/javascript" defer=true>
      var now = new Date();
      length = 5;
      function update() {
        var grt = new Date('01/01/2022 00:00:00');
        now.setTime(now.getTime() + 250);
        var days = (now - grt) / 1000 / 60 / 60 / 24;
        if (length >= 2){
          var dnum = Math.floor(days);
          document.getElementById("dnum").innerHTML = dnum;
          document.getElementById("dnum").style.display = "inline";
        }
        if (length >= 3){
          hours = (now - grt) / 1000 / 60 / 60 - (24 * dnum);
          hnum = Math.floor(hours);
          if (String(hnum).length == 1) {
            hnum = "0" + hnum;
          }
          document.getElementById("hnum").innerHTML = hnum;
          document.getElementById("hnum").style.display = "inline";
        }
        if (length >= 4){
          minutes = (now - grt) / 1000 / 60 - (24 * 60 * dnum) - (60 * hnum);
          mnum = Math.floor(minutes);
          if (String(mnum).length == 1) {
            mnum = "0" + mnum;
          }
          document.getElementById("mnum").innerHTML = mnum;
          document.getElementById("mnum").style.display = "inline";
        }
        if (length >= 5){
          seconds = (now - grt) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
          snum = Math.round(seconds);
          if (String(snum).length == 1) {
            snum = "0" + snum;
          }
          document.getElementById("snum").innerHTML = snum;
          document.getElementById("snum").style.display = "inline";
        }
      }
      setInterval("update()", 250);
    </script>
	
	
	<div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
	
  </div>


  
  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        
      </a>
    </span>
    
      
        <span class="beian-police">
          
          <span class="beian-police">蜀ICP备2020026333号</span>
        </span>
      
    
  </div>


  
  
</footer>




  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        loader: {
          load: ['ui/lazy']
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" ></script>

  





  <script  src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({"theme":"default"});
    }
  </script>




  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?bb2c8c85e6445862aff762b6b3f0564b";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  




  
<script src="/js/diy/caidai.js"></script>
<script src="/js/diy/xiantiao.js"></script>
<script src="/js/diy/xiaoxingxing.js"></script>
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/xiaoxuehua.js"></script>



<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
